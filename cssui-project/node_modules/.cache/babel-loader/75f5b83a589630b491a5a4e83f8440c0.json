{"remainingRequest":"D:\\10_vuespaces\\cssui-project\\node_modules\\babel-loader\\lib\\index.js!D:\\10_vuespaces\\cssui-project\\src\\router\\index.js","dependencies":[{"path":"D:\\10_vuespaces\\cssui-project\\src\\router\\index.js","mtime":1604547050797},{"path":"D:\\10_vuespaces\\cssui-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\10_vuespaces\\cssui-project\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport Router from 'vue-router';\nimport { $store } from '../store';\nimport Login from '@/views/Login';\nimport Index from '@/views/Index.vue';\nimport Cookies from \"js-cookie\";\nVue.use(Router);\n\nvar isLogin = function isLogin() {\n  if (sessionStorage.getItem(\"userId\") && sessionStorage.getItem(\"userName\")) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nvar loadUser = function loadUser(sucess) {\n  var vue = new Vue();\n  vue.$http.user.getUserByCookie().then(function (res) {\n    if (res) {\n      $store().commit(\"setUserInfo\", res); // 保存当前登录用户信息\n\n      sessionStorage.setItem(\"userId\", res.uuid);\n      sessionStorage.setItem(\"userName\", res.realName);\n\n      if (sucess) {\n        sucess();\n      }\n    }\n  }).catch(function (error) {\n    console.log(error);\n  });\n};\n\nvar loginAuth = function loginAuth(ticket, sucess) {\n  var vue = new Vue();\n  vue.$http.login.ssoTicket({\n    cssSsoTicket: ticket\n  }).then(function (res) {\n    if (sucess) {\n      sucess();\n    }\n  }).catch(function (res) {\n    alert(res.response.data.detail);\n  });\n};\n\nvar router = new Router({\n  routes: [{\n    path: '/',\n    name: '首页',\n    component: Index,\n    meta: {\n      requireAuth: true\n    }\n  }, {\n    path: '/login',\n    name: '登录',\n    component: Login\n  }]\n});\nrouter.beforeEach(function (to, from, next) {\n  if (to.meta.requireAuth) {\n    //判断该路由是否需要登录权限\n    if (isLogin()) {\n      next();\n    } else {\n      if (window.location.href.indexOf('cssSsoTicket') >= 0) {\n        // 如果cssSsoTicket存在\n        //如果url中包含cssSsoTicket   split？分割成数组，取第二个\n        var cssSsoTicket = window.location.search.split(\"cssSsoTicket\")[1].substring(1);\n        loginAuth(cssSsoTicket, function () {\n          loadUser(function () {\n            next();\n          });\n        });\n      } else {\n        loadUser(function () {\n          next();\n        });\n      }\n    }\n  } else {\n    next();\n  }\n\n  if (to.meta.title) {\n    document.title = to.meta.title;\n  }\n});\nexport default router;",{"version":3,"sources":["D:/10_vuespaces/cssui-project/src/router/index.js"],"names":["Vue","Router","$store","Login","Index","Cookies","use","isLogin","sessionStorage","getItem","loadUser","sucess","vue","$http","user","getUserByCookie","then","res","commit","setItem","uuid","realName","catch","error","console","log","loginAuth","ticket","login","ssoTicket","cssSsoTicket","alert","response","data","detail","router","routes","path","name","component","meta","requireAuth","beforeEach","to","from","next","window","location","href","indexOf","search","split","substring","title","document"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,MAAP,MAAmB,YAAnB;AACA,SACCC,MADD,QAEO,UAFP;AAGA,OAAOC,KAAP,MAAkB,eAAlB;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AACA,OAAOC,OAAP,MAAoB,WAApB;AACAL,GAAG,CAACM,GAAJ,CAAQL,MAAR;;AACA,IAAIM,OAAO,GAAG,SAAVA,OAAU,GAAM;AACnB,MAAIC,cAAc,CAACC,OAAf,CAAuB,QAAvB,KAAoCD,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAxC,EAA4E;AAC3E,WAAO,IAAP;AACA,GAFD,MAEO;AACN,WAAO,KAAP;AACA;AACD,CAND;;AAOA,IAAIC,QAAQ,GAAG,SAAXA,QAAW,CAACC,MAAD,EAAY;AAC1B,MAAIC,GAAG,GAAG,IAAIZ,GAAJ,EAAV;AACAY,EAAAA,GAAG,CAACC,KAAJ,CAAUC,IAAV,CACEC,eADF,GAEEC,IAFF,CAEO,UAAAC,GAAG,EAAI;AACZ,QAAGA,GAAH,EAAO;AACNf,MAAAA,MAAM,GAAGgB,MAAT,CAAgB,aAAhB,EAA+BD,GAA/B,EADM,CAC+B;;AACrCT,MAAAA,cAAc,CAACW,OAAf,CAAuB,QAAvB,EAAiCF,GAAG,CAACG,IAArC;AACAZ,MAAAA,cAAc,CAACW,OAAf,CAAuB,UAAvB,EAAmCF,GAAG,CAACI,QAAvC;;AACA,UAAIV,MAAJ,EAAY;AACXA,QAAAA,MAAM;AACN;AACD;AACD,GAXF,EAWIW,KAXJ,CAWU,UAAAC,KAAK,EAAI;AACjBC,IAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACA,GAbF;AAcA,CAhBD;;AAiBA,IAAIG,SAAS,GAAG,SAAZA,SAAY,CAACC,MAAD,EAAShB,MAAT,EAAoB;AACnC,MAAIC,GAAG,GAAG,IAAIZ,GAAJ,EAAV;AACAY,EAAAA,GAAG,CAACC,KAAJ,CAAUe,KAAV,CACEC,SADF,CACY;AACVC,IAAAA,YAAY,EAAEH;AADJ,GADZ,EAIEX,IAJF,CAIO,UAAAC,GAAG,EAAI;AACZ,QAAIN,MAAJ,EAAY;AACXA,MAAAA,MAAM;AACN;AACD,GARF,EAQIW,KARJ,CAQU,UAAAL,GAAG,EAAI;AACfc,IAAAA,KAAK,CAACd,GAAG,CAACe,QAAJ,CAAaC,IAAb,CAAkBC,MAAnB,CAAL;AACA,GAVF;AAWA,CAbD;;AAcA,IAAMC,MAAM,GAAG,IAAIlC,MAAJ,CAAW;AACzBmC,EAAAA,MAAM,EAAE,CAAC;AACPC,IAAAA,IAAI,EAAE,GADC;AAEPC,IAAAA,IAAI,EAAE,IAFC;AAGPC,IAAAA,SAAS,EAAEnC,KAHJ;AAIPoC,IAAAA,IAAI,EAAE;AACLC,MAAAA,WAAW,EAAE;AADR;AAJC,GAAD,EAQP;AACCJ,IAAAA,IAAI,EAAE,QADP;AAECC,IAAAA,IAAI,EAAE,IAFP;AAGCC,IAAAA,SAAS,EAAEpC;AAHZ,GARO;AADiB,CAAX,CAAf;AAiBAgC,MAAM,CAACO,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACrC,MAAIF,EAAE,CAACH,IAAH,CAAQC,WAAZ,EAAyB;AAAE;AAC1B,QAAIlC,OAAO,EAAX,EAAe;AACdsC,MAAAA,IAAI;AACJ,KAFD,MAEO;AACN,UAAIC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,OAArB,CAA6B,cAA7B,KAAgD,CAApD,EAAuD;AAAE;AACxD;AACA,YAAInB,YAAY,GAAGgB,MAAM,CAACC,QAAP,CAAgBG,MAAhB,CAAuBC,KAAvB,CAA6B,cAA7B,EAA6C,CAA7C,EAAgDC,SAAhD,CAA0D,CAA1D,CAAnB;AACA1B,QAAAA,SAAS,CAACI,YAAD,EAAe,YAAW;AAClCpB,UAAAA,QAAQ,CAAC,YAAW;AACnBmC,YAAAA,IAAI;AACJ,WAFO,CAAR;AAGA,SAJQ,CAAT;AAKA,OARD,MAQO;AACNnC,QAAAA,QAAQ,CAAC,YAAW;AACnBmC,UAAAA,IAAI;AACJ,SAFO,CAAR;AAGA;AACD;AACD,GAlBD,MAkBO;AACNA,IAAAA,IAAI;AACJ;;AACD,MAAIF,EAAE,CAACH,IAAH,CAAQa,KAAZ,EAAmB;AAClBC,IAAAA,QAAQ,CAACD,KAAT,GAAiBV,EAAE,CAACH,IAAH,CAAQa,KAAzB;AACA;AACD,CAzBD;AA0BA,eAAelB,MAAf","sourcesContent":["import Vue from 'vue'\r\nimport Router from 'vue-router'\r\nimport {\r\n\t$store\r\n} from '../store'\r\nimport Login from '@/views/Login'\r\nimport Index from '@/views/Index.vue'\r\nimport Cookies from \"js-cookie\";\r\nVue.use(Router)\r\nvar isLogin = () => {\r\n\tif (sessionStorage.getItem(\"userId\") && sessionStorage.getItem(\"userName\")) {\r\n\t\treturn true\r\n\t} else {\r\n\t\treturn false\r\n\t}\r\n}\r\nvar loadUser = (sucess) => {\r\n\tvar vue = new Vue();\r\n\tvue.$http.user\r\n\t\t.getUserByCookie()\r\n\t\t.then(res => {\r\n\t\t\tif(res){\r\n\t\t\t\t$store().commit(\"setUserInfo\", res); // 保存当前登录用户信息\r\n\t\t\t\tsessionStorage.setItem(\"userId\", res.uuid);\r\n\t\t\t\tsessionStorage.setItem(\"userName\", res.realName);\r\n\t\t\t\tif (sucess) {\r\n\t\t\t\t\tsucess();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).catch(error => {\r\n\t\t\tconsole.log(error);\r\n\t\t});\r\n}\r\nvar loginAuth = (ticket, sucess) => {\r\n\tvar vue = new Vue();\r\n\tvue.$http.login\r\n\t\t.ssoTicket({\r\n\t\t\tcssSsoTicket: ticket\r\n\t\t})\r\n\t\t.then(res => {\r\n\t\t\tif (sucess) {\r\n\t\t\t\tsucess();\r\n\t\t\t}\r\n\t\t}).catch(res => {\r\n\t\t\talert(res.response.data.detail);\r\n\t\t});\r\n}\r\nconst router = new Router({\r\n\troutes: [{\r\n\t\t\tpath: '/',\r\n\t\t\tname: '首页',\r\n\t\t\tcomponent: Index,\r\n\t\t\tmeta: {\r\n\t\t\t\trequireAuth: true\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: '/login',\r\n\t\t\tname: '登录',\r\n\t\t\tcomponent: Login\r\n\t\t},\r\n\t]\r\n\r\n})\r\nrouter.beforeEach((to, from, next) => {\r\n\tif (to.meta.requireAuth) { //判断该路由是否需要登录权限\r\n\t\tif (isLogin()) {\r\n\t\t\tnext();\r\n\t\t} else {\r\n\t\t\tif (window.location.href.indexOf('cssSsoTicket') >= 0) { // 如果cssSsoTicket存在\r\n\t\t\t\t//如果url中包含cssSsoTicket   split？分割成数组，取第二个\r\n\t\t\t\tvar cssSsoTicket = window.location.search.split(\"cssSsoTicket\")[1].substring(1);\r\n\t\t\t\tloginAuth(cssSsoTicket, function() {\r\n\t\t\t\t\tloadUser(function() {\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tloadUser(function() {\r\n\t\t\t\t\tnext();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tnext();\r\n\t}\r\n\tif (to.meta.title) {\r\n\t\tdocument.title = to.meta.title;\r\n\t}\r\n});\r\nexport default router\r\n"]}]}